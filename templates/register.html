{% extends "base.html" %}
{% block content %}

<style>
    .section { display: none; margin-top: 15px; }
    .form-label { margin-top: 10px; }
</style>

<div class="container mt-5">
    <h2 class="mb-4 text-center">Register a New Account</h2>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-danger">
          <ul class="mb-0">
            {% for msg in messages %}
              <li>{{ msg }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    {% endwith %}

    <form action="{{ url_for('registerAuth') }}" method="POST" class="bg-white p-4 shadow-sm rounded">

        <!-- Role Selection -->
        <div class="mb-3">
            <label class="form-label">Role</label>
            <select name="role" id="role" class="form-select" required onchange="toggleFields()">
                <option value="">-- Select Role --</option>
                <option value="customer">Customer</option>
                <option value="agent">Booking Agent</option>
                <option value="staff">Airline Staff</option>
            </select>
        </div>

        <!-- Main Login Info -->
        <div class="mb-3">
            <label class="form-label">Email (Username)</label>
            <input type="email" name="email" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" name="password" class="form-control" required>
        </div>


        <!-- Customer Fields -->
        <div id="customerFields" class="section">
            <h5 class="mt-4">Customer Info</h5>

            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">Name</label>
                    <input type="text" name="cust_name" class="form-control">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Phone #</label>
                    <input type="text" name="phone_number" class="form-control">
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <label class="form-label">Building #</label>
                    <input type="text" name="building_number" class="form-control">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Street</label>
                    <input type="text" name="street" class="form-control">
                </div>
                <div class="col-md-4">
                    <label class="form-label">City</label>
                    <input type="text" name="city" class="form-control">
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">State</label>
                    <input type="text" name="state" class="form-control">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Passport #</label>
                    <input type="text" name="passport_number" class="form-control">
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">Passport Expiry</label>
                    <input type="date" name="passport_expiration" class="form-control">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Passport Country</label>
                    <input type="text" name="passport_country" class="form-control">
                </div>
            </div>

            <div class="mt-3">
                <label class="form-label">Date of Birth</label>
                <input type="date" name="cust_dob" class="form-control">
            </div>
        </div>


        <!-- Staff Fields -->
        <div id="staffFields" class="section">
            <h5 class="mt-4">Staff Info</h5>

            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">First Name</label>
                    <input type="text" name="staff_first" class="form-control">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Last Name</label>
                    <input type="text" name="staff_last" class="form-control">
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">Date of Birth</label>
                    <input type="date" name="staff_dob" class="form-control">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Airline Name</label>
                    <input type="text" name="airline_name" class="form-control">
                </div>
            </div>
        </div>


        <div class="text-center mt-4">
            <input type="submit" value="Register" class="btn btn-primary">
        </div>

    </form>

    <div class="text-center mt-3">
        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Back to Home</a>
    </div>
</div>


<script>
function toggleFields() {
    const role = document.getElementById("role").value;

    document.getElementById("customerFields").style.display =
        (role === "customer") ? "block" : "none";

    document.getElementById("staffFields").style.display =
        (role === "staff") ? "block" : "none";

    document.querySelectorAll("#customerFields input")
        .forEach(i => i.disabled = (role !== "customer"));

    document.querySelectorAll("#staffFields input")
        .forEach(i => i.disabled = (role !== "staff"));
}

window.onload = toggleFields;
</script>

{% endblock %}
